<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>{$title} 武汉热线</title>
	<link rel="stylesheet" href="{IMG_URL}templates/wuhan/2014/css/main.css">
	<link rel="stylesheet" href="{IMG_URL}templates/wuhan/2014/sea-modules/alice/base/1.0.2/base-debug.css">
	<link rel="stylesheet" href="{IMG_URL}templates/wuhan/2014/css/font-awesome.min.css">
	<script type="text/javascript" src="{IMG_URL}templates/wuhan/2014/sea-modules/seajs/seajs/2.2.0/sea.js"></script>
	<script src="{IMG_URL}templates/wuhan/2014/sea-modules/jquery/jquery/1.10.1/jquery.js" type="text/javascript"></script>
	<script type="text/javascript" src="{IMG_URL}js/config.js"></script>

</head>
<body>

	<!-- 项部工具条 -->
	<!--#include virtual="/section/249.html"-->

	<!-- 通栏广告 -->
	<!--#include virtual="/section/241.html"-->

	<!-- LOGO和搜索 -->
	<!--#include virtual="/section/253.html"-->

	<!-- 小导航 -->
	<!--#include virtual="/section/257.html"-->

	<!-- 主容器 -->
	<div class="layout mt12 fn-clear">

		<!-- 面包屑 -->
		<div class="breadcrumb">
			<span><i class="fa fa-home"></i> <a href="http://www.wuhan.net.cn/">武汉热线</a>
				<!--{loop $pos $k $cat}-->
				 > <a href="{$cat[url]}">{$cat[name]}</a>
				<!--{/loop}-->
			</span>
		</div>

		<!-- 左侧容器 -->
		<div class="mainBody jrtjMod bd" id="newsContent">
			<div class="newsArticle mt12">

				<h1 class="">{$title}</h1>
				<h2 class="fn-clear">
					<div class="fn-left ">
						<span>来源：{$source_name}</span> | 
						<span>发布时间：{date('Y-m-d H:i', $published)}</span>
					</div>

					<div class="fn-right">
						<div class="bdsharebuttonbox fn-left">
							<span class="fn-left">分享到:</span><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a></div>

						<div class="fz-adjust fn-left">字号：
							<a href="javascript:;" class="small">小</a>
							<a href="javascript:;" class="large">大</a>
						</div>
					</div>

					<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdPic":"","bdStyle":"0","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
				</h2>

				<div class="recommendNews fn-clear">
					<h3 class="title">推荐阅读</h3>
					<!-- 推荐阅读 -->
					<!--#include virtual="/section/403.html"-->
				</div>

				<!--{if $description}-->
				<p class="titdd-Article">
					[<strong>内容摘要:</strong>]
					{$description}
				</p>
				<!--{/if}-->

				<div class="mt12">
					{$content}
				</div>

				<h2 class="fn-clear mt100">
					<div class="fn-right ">
						<!--{if $editor}-->
						<span>责任编辑：{$editor}</span>
						<!--{/if}-->
					</div>
				</h2>

			</div>

			<!-- 智慧城市 -->
			<!--#include virtual="/section/275.html"-->

			<!-- 表情 -->
			<!--{template '2014/mood.html'}-->

		</div>

		<!-- 右侧容器 -->
		<div class="layoutRight">

			<!-- ADBox -->
			<!--#include virtual="/section/245.html"-->
			
			<!-- 资讯排行 -->
			<div class="rightArea fn-clear mt12 rightNews" id="sideNewsTextTabs">
				<ul class="ui-switchable-nav">
					<h2>资讯排行</h2>
					<li>日</li>
					<li>周</li>
					<li>月</li>
				</ul>
				<div class="ui-switchable-content">
					<div class="hidden col">
						<!--#include virtual="/section/267.html"-->
					</div>
					<div class="hidden col">
						<!--#include virtual="/section/269.html"-->
					</div>
					<div class="hidden col">
						<!--#include virtual="/section/271.html"-->
					</div>
				</div>
			</div>

			<!-- 热点关注 -->
			<div class="rightArea fn-clear mt12 rightNews" id="sideNewsImgTabs">
				<ul class="ui-switchable-nav">
					<h2>热点关注</h2>
					<li>活动</li>
					<li>房产</li>
					<li>家居</li>
					<li>资讯</li>
				</ul>
				<!--#include virtual="/section/265.html"-->   
			</div>

			<!-- 生活万象 -->
			<div class="rightArea fn-clear mt12 rightNews" id="mediafocus">
				<div class="hd"><h2>生活万象</h2></div>
				<div class="contents">
					<!--#include virtual="/section/273.html"-->
				</div>
			</div>

		</div>
	</div>

	<!-- 友情链接 -->
	<!--#include virtual="/section/261.html"-->

	<!-- 版权信息 -->
	<!--#include virtual="/section/263.html"-->

	<script>
	
		// base:"./sea-modules",
		seajs.config({
			alias:{
				"$":"jquery/jquery/1.10.1/jquery.js",
				"detector":"arale/detector/1.4.0/detector.js",
				"jquery-easing":"jquery/easing/1.3.0/easing.js"
			}
		});

		// detector
		seajs.use(['detector'],function(detector){
			var deviceName = detector.os.name;
			if(deviceName == "ios" || deviceName == "android" ) {
				window.location.href = 'http://115.29.207.162/whol2014/MoMain.html';
			}
		});

		// popup
		seajs.use(['arale/popup/1.1.6/popup'], function(Popup){
			new Popup({
				trigger: '#smartPoint',
				element: '#popupPoint'
			});
			new Popup({
				trigger: '#mail189',
				element: '#popupMail'
			});
			new Popup({
				trigger: '#personalSetting',
				element: '#popupSetting'
			});
			new Popup({
				trigger: '#loginWhol',
				element: '#popupLogin'
			});
			new Popup({
				trigger: '#signOut',
				element: '#popupsignOut'
			});
		});

		// Tabs
		seajs.use(['arale/switchable/1.0.2/tabs'], function(Tabs) {

			sideNewsImgTabs = new Tabs({
				element: '#sideNewsImgTabs',
				triggers: '#sideNewsImgTabs .ui-switchable-nav li',
				panels: '#sideNewsImgTabs .ui-switchable-content .col',
				activeIndex: 0
			});

			sideNewsTextTabs = new Tabs({
				element: '#sideNewsTextTabs',
				triggers: '#sideNewsTextTabs .ui-switchable-nav li',
				panels: '#sideNewsTextTabs .ui-switchable-content .col',
				activeIndex: 0
			});

			setTimeout(function() {
				sideNewsImgTabs.set("activeIndex", 0);
				sideNewsTextTabs.set("activeIndex", 0);
			}, 3000);
		});

		// jquery
		seajs.use(['$'],function($){

			// stat
			var contentid = {$contentid};
			$.getJSON(APP_URL+'?app=system&controller=content&action=stat&jsoncallback=?&contentid='+contentid, function(data){});

			// font-size
			$('.large').click(function(){
				$('.newsArticle p').css("font-size","16px");
			});
			$('.small').click(function(){
				$('.newsArticle p').css("font-size","14px");
			});

			// loginsmartcity
			$('.btn').click(function(){
				login();
			});
			$('#signOutBtn').click(function(){
				signOut();
			});

			// cookie helper	
			(function (factory) {
				if (typeof define === 'function' && define.amd) {					
					define(['jquery'], factory);
				} else if (typeof exports === 'object') {					
					factory(require('jquery'));
				} else {					
					factory(jQuery);
				}
			}(function ($) {
				var pluses = /\+/g;
				function encode(s) {
					return config.raw ? s : encodeURIComponent(s);
				}
				function decode(s) {
					return config.raw ? s : decodeURIComponent(s);
				}
				function stringifyCookieValue(value) {
					return encode(config.json ? JSON.stringify(value) : String(value));
				}
				function parseCookieValue(s) {
					if (s.indexOf('"') === 0) {						
						s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
					}
					try {
						s = decodeURIComponent(s.replace(pluses, ' '));
						return config.json ? JSON.parse(s) : s;
					} catch(e) {}
				}
				function read(s, converter) {
					var value = config.raw ? s : parseCookieValue(s);
					return $.isFunction(converter) ? converter(value) : value;
				}
				var config = $.cookie = function (key, value, options) {
					// Write
					if (value !== undefined && !$.isFunction(value)) {
						options = $.extend({}, config.defaults, options);
						if (typeof options.expires === 'number') {
							var days = options.expires, t = options.expires = new Date();
							t.setTime(+t + days * 864e+5);
						}
						return (document.cookie = [
							encode(key), '=', stringifyCookieValue(value),
							options.expires ? '; expires=' + options.expires.toUTCString() : '', 
							options.path    ? '; path=' + options.path : '',
							options.domain  ? '; domain=' + options.domain : '',
							options.secure  ? '; secure' : ''
						].join(''));
					}
					// Read
					var result = key ? undefined : {};
					var cookies = document.cookie ? document.cookie.split('; ') : [];
					for (var i = 0, l = cookies.length; i < l; i++) {
						var parts = cookies[i].split('=');
						var name = decode(parts.shift());
						var cookie = parts.join('=');
						if (key && key === name) {	
							result = read(cookie, value);
							break;
						}
						if (!key && (cookie = read(cookie)) !== undefined) {
							result[name] = cookie;
						}
					}
					return result;
				};
				config.defaults = {};
				$.removeCookie = function (key, options) {
					if ($.cookie(key) === undefined) {
						return false;
					}
					$.cookie(key, '', $.extend({}, options, { expires: -1 }));
					return !$.cookie(key);
				};
			}));
			
			// ajax
			if($.cookie('username')&&$.cookie('password')){
				login();
			}
			function login(){
				if($.cookie('username')&&$.cookie('password')){
					var username = $.cookie('username');
					var password = $.cookie('password');		
				}else{
					var username = $('#username').val();
					var password = $('#password').val();	
				}				
				$.ajax({  
					type: "post",  
					url : "http://115.29.207.162/video/index.php?m=User&c=Index&a=login",
					dataType:'jsonp',
					jsonp:'callback',
					data: 'username='+username+'&password='+password, 
					success: function(json){
						if(json.returnCode==1){	
							$.cookie('username',username,{ expires: 30, path: '/' });
							$.cookie('password',password,{ expires: 30, path: '/' });
								$('.user').removeClass('fn-hide');
								$('.topfunc').removeClass('hidden');
								$('#loginWhol').hide();
								if (json.returnData.nick !='') {
									$('.user').html("您好，" + json.returnData.nick); 
								}else{
									$('.user').html("您好，" + json.returnData.username); 
								}
								$('#level').html("等级："+json.returnData.achievement.level_info.level);
								$('#currency').html("智慧币：" + json.returnData.achievement.currency);
								if(!$('.error').hasClass('fn-hide')){
									$('.error').addClass('fn-hide');
								}
						}else {
							$.removeCookie('username');
							$.removeCookie('password');
							$('.error').removeClass('fn-hide');
						}
					}
				}); 
			}
			function signOut() {
				$.removeCookie('username', { path: '/' });
				$.removeCookie('password', { path: '/' });
				
				$('#level').html("等级");
				$('#currency').html("智慧币");
				$('#loginWhol').show();
				
				$('.user').addClass('fn-hide');
				$('.topfunc').addClass('hidden');
				
				$('#username').val('');
				$('#password').val('');	
			}

			//test for page voting.
			var mood_img_url = IMG_URL+'apps/mood/';
			var votehtml= $('#mood').html();
			//digg.get(contentid);

			$('#mood li a, #mood li input').click(function(){
				var moodsid = $(this).attr('moodsid');
				console.log(moodsid);
				vote(moodsid);
			});


			function vote(vote_id) {
				if ( ( new Date().getTime() - $.cookie('mood_time'+contentid) ) > 1000*{setting('mood','votetime')} ) {
					$.getJSON(APP_URL+"?app=mood&controller=index&action=vote&contentid="+contentid+"&voteid="+vote_id+"&jsoncallback=?", function(json){
						voteShow(json);
					});
				} else {
					alert("请勿重复刷新");
					$.getJSON(APP_URL+"?app=mood&controller=index&action=vote&contentid="+contentid+"&jsoncallback=?", function(json){
						voteShow(json);
					});
				}
				$.cookie("mood_time"+contentid, new Date().getTime());
			}
			function voteShow(json) {
				$("#mood").html(votedhtml + '<ul class="clear">' + $("ul:last", "#mood").html() + '</ul>').hide().fadeIn(450 | "slow").find(':radio').remove();
				$('#vote_total').html(json.total);
				for(var i in json.data) {
					$('#'+i+'_li em').html(json.data[i].number);
					$('#'+i+'_bar').css({"height": json.data[i].height+'%'}); 
				}
			}
			var votedhtml = '<style>\
			.mood_bar {position:relative; width:24px; height:100px;background:#EEF7F7; margin:0 auto;}\
			.mood_bar_in {background:url({IMG_URL}apps/mood/images/moodrank.gif) repeat-y -2px 0;bottom:0;left:0;position:absolute;width:24px;}\
			</style>\
			<div class="titles layout">\
			<h3 class="mar-b-10 txt-l"><span class="f-r" style="width: 80px;"></span>\
			已经有 <font color="red" id="vote_total"></font> 人表态：</h3>\
				<ul id="clear layout">\
				<!--{db sql="select * from #table_mood where 1"}-->
				<li id="m{$r[moodid]}_li">\
				<em></em><div class="mood_bar"><div class="mood_bar_in" id="m{$r[moodid]}_bar"></div></div>\
				</li>\
				<!--{/db}-->
			</ul></div>';
			
		});

	</script>

</body>
</html>